---
title: "Hausaufgabe 06 - Treibhausgase"
author: "Füge deinen Namen hier hinzu"
date: "Füge das Datum hier hinzu"
output: 
  html_document: 
    toc: yes
    toc_float: true
---

```{r setup, include=FALSE}
# Ich habe hier ein paar Standardeinstellungen für dich vorgenommen
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

# Lade Packages

```{r lade-packages, message=FALSE}

# Ich habe die Packages bereits für dich geladen
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(forcats)

```

# Tastaturkürzel

Ich habe hier nochmals die wichtigsten Tastaturkürzel für dich hinzugefügt

- **Einen neuen Code-chunk hinzufügen:** Ctrl + Alt + I
- **Code "Zeile für Zeile" innerhalb eines Code-chunks ausführen:** Ctrl + Enter
- **Den gesamten Code-chunk ausführen:** Ctrl + Shift + Enter
- **Die Pipe (%>%):** Ctrl + Shift + M
- **Der Zuweisungs-Operator (<-)**: Alt + -


# Übungen - Teil 1 - Projektarbeit

Im Anschluss an die sieben Kurseinheiten bekommt ihr die Gelegenheit als Teil eines kleinen Abschlussprojektes Unterstützung zu erhalten. 

Dafür braucht es ein paar Vorraussetzungen:

1. R, RStudio und Git sind auf euren Arbeitsgeräten installiert
2. Daten für die Projektarbeit sind ausgewählt
3. Ein öffentliches (public) GitHub Repository wurde erstellt **oder** ein geschlossenes (private) GitHub Repository wurde erstellt zu welchem der GitHub Benutzer larnsce als Collaborator hinzugefügt wurde.

**Beachte:** Auch Projekte mit sensitiven und schützenswerten Daten können öffentlich publiziert werden. Dazu werden Ordner und/oder Dateien mit den zu schützenden Daten in der `.gitignore` Datei hinzugefügt. Somit wird erreicht, dass die Daten nicht zugänglich sind, jedoch der Code für die Arbeit mit den Daten, was deutlich zu einer transparenten Arbeitsweise beiträgt auch wenn die Ergebnisse nicht reproduzierbar sind. Dabei wird empfohlen sich innerhalb der Verwaltungseinheit mit den zuständigen Mitarbeiter_innen für Datenschutz in Verbindung zu setzen. 

4. Das GitHub Repository auf das eigene Arbeitsgerät klonen und daraus ein RStudio Project machen

Diese Übung soll sicherstellen, dass all diese Vorraussetzungen erfüllt sind.

## Installation von R, RStudio und Git

1. Wendet euch an eure IT um die nötige Software installiert zu bekommen:

https://github.com/rstatsZH/kochbuch/tree/main/01-Installation

## Daten für das Projekt

Ideale Daten für das Projekt gibt es nicht, jedoch ist es sinnvoll nicht unbedingt Daten auszuwählen welche streng vertraulich sind, oder Daten welche Teil eines sehr grossen Projektes sind. Bereits öffentlich verfügbare Daten sind wertvoll wenn es euch wichtig ist das Projekt öffentlich und reproduzierbar zu publizieren. Das wichtigste Kritierium an die Daten ist jedoch, dass ihr Interesse daran habt den Datensatz zu erkunden und Fragen zu stellen und zu beantworten.

1. Einen Datensatz, oder mehrere Datensätze, für das Projekt identifizieren.

## GitHub Repository erstellen

Wie das geht hast du in [Übung 1 der Hausaufgabe aus Woche 5](https://rstatszh.github.io/website/ha-05-erstes-projekt.html#%C3%BCbung-1---erstelle-ein-eigenes-git-repository) gelernt. Falls du Schwierigkeiten hast meiner Anleitung zu folgen, melde dich umgehend und ich kann dich unterstützen. 

Abweichend von der Anleitung ist Folgendes:

- 1. + 2. Schritt: Diese Schritte kannst du überspringen und das neue Repository unter deinem Benutzernamen erstellen. Beginne also mit dem 3. Schritt und erstelle ein neues Repository in deinem persönlichen Benutzer Account.
- 4. Schritt: Überlege dir hier einen eigenen, sinnvollen Namen für das Repository
- 6. Schritt: Entscheide hier selbst darüber ob du das Repository öffentlich (public) oder geschlossen (private) zugänglich machen möchtest. 

Auch wird dieses Mal kein Project in der RStudio Cloud erstellt, sondern auf deinem eigenen Arbeitsgerät. Überspringe deshalb die Schritte 12 bis 17 und ersetze diese durch Folgendes:

- Öffne RStudio auf deinem Arbeitsgerät
- Klicke auf File > New Project. Ein neues Fenster öffnet sich.

```{r}

```

- Klicke auf "Version Control", dann klicke auf "Git"

```{r}

```

- Füge die URL aus deiner Zwischenablage im Feld "Repository URL" ein. Im Feld "Project directory name:" wird der Name des Repositories übernommen. 

```{r}

```

- Wähle über den Button "Browse..." den Ordner auf deinem Arbeitsgerät aus, in dem du das Repository speichern möchtest (**Tipp:** Ich empfehle einen Ordner names "gitrepos" zu erstellen, welcher sich so nah wie möglich am Stammpfad des Laufwerks (Lokaler Datenträger) auf deinem Arbeitsgerät befindet. Im Windows Betriebssystem ist dies üblicherweise "C:". As bietet sich an, an dem Ort 'C:\gitrepos' nur Ordner anzulegen, welche auch ein Git Repository sind. Dies erlaubt eine saubere Trennung zwischen allgemeinen Ordnern auf deinem Arbeitsgerät und solchen die ein Git Repository sind. 

```{r}

```

- Klicke auf "Create Project", was für dich die folgenden drei Dinge erstellt
    - ein Ordner auf deinem Arbeitsgerät
    - ein lokales Git Repository welches mit einem remote GitHub Repository verbunden ist
    - ein RStudio Project

```{r}

```

- Betrachte dein offenes RStudio Project
- Folge nun noch den Schritten 38 bis 43 aus der Hausaufgabe 5.

Als nächstes könntest du mittels eines Dateimanagers (z.B. Windows File Explorer) deine Daten für das Projekt in dieses Repository kopieren. Es empfiehlt sich dazu innerhalb des Repositories einen Ordner namens "data" zu erstellen und die Daten dort abzulegen.

```{r}

```

Wie du nun weiter machst ist dir überlassen. Möchtest du nicht, dass die Daten welche lokal gespeichert sind auf GitHub auftauchen? Dann füge den Pfad an dem diese liegen zu deiner `.gitignore` Datei hinzu (siehe Screenshot und ersetze den Namen data ggf. durch den Namen den du für diesen Ordner gewählt hast. 

```{r}

```

Auch ist es nützlich eine README.md Datei zu erstellen in diese im Stammpfad des Repositories zu speichern. In der README kannst du dein Projekt beschreiben oder wichtige Vorraussetzungen für die Nutzung und Wiederverwendbarkeit deklarieren (Lizenzen). 

Sobald du zufrieden bist mit dem Aufbau deines Projektordners kannst du deine Veränderung mittels den dir bekannten Schritten und unter dem Git Reiter oben rechts in RStudio zurück auf GitHub pushen. 

# Übungen - Teil 2 - Treibhausgase 

## Übung 1 - Daten importieren

1. Importiere Die CSV Ressource aus dem folgendenden Metadateneintrag in deine Arbeitsumgebung: https://opendata.swiss/de/dataset/treibhausgasemissionen-stadt-zurich-ohne-klimakorrektur-1990-20163

Dir sind zwei Wege bekannt um dies zu erreichen. Schau bei Bedarf im Praktikum 8 oder im Praktikum 9 nach. Den Namen für das Objekt in deiner Arbeitsumgebung (Environment) kannst du selbst auswählen.

2. Strick das Dokument und dann: git add, commit, push alle Veränderung zurück auf GitHub

```{r}
ghg <- read_csv("https://data.stadt-zuerich.ch/dataset/ugz_treibhausgasbilanz/download/ugz_treibhausgasbilanz.csv")
```

## Übung 2 - Daten transformieren und visualisieren

### 2.1 Pivoting

Die Daten sind derzeit in einem weiten Format. Das Ziel ist die Daten in ein langes Format zu bringen wobei nur die Spalte Jahr beibehalten wird und alle Spalten von Strom bis Heizoel_EL gedreht werden. Ich habe dir hier bereits etwas Code mit Lücken als Hilfestellung vorbereitet.

1. Erstelle ein neues Objekt in deiner Arbeitsumgebung (Environment), welches im langen Format ist in dem du die Lücken ausfüllst. Den Namen für das Objekt kannst du selbst auswählen.

```{r, eval=FALSE}

___ <- ___ %>% 
  ____longer(
    
    # In diesem Argument werden die Spalten ausgewählt welche gedreht werden
    ___ = !Jahr,            
    
    # In diesem Argument wird der Name für die neue Spalte definiert, welche
    # die Namen aus den zuvor ausgewählten Spalten enthält
    ___ = "Energietraeger", 
    
    # In diesem Argument wird der Name für die neue Spalte definiert, welche
    # die Werte aus den zuvor ausgewählten Spalten enhält
    ___ = "Emissionen"
  )

```


```{r}
ghg_long <- ghg %>% 
  pivot_longer(cols = !Jahr,
               names_to = "Energietraeger",
               values_to = "Emissionen")
```

### 2.2 Daten zusammenfassen und neue Variable erstellen

1. Wieviele Spalten und Reihen hat das neue Objekt welches du im Schritt zuvor erstellt hast? **Beachte: Falls dies nicht 3 Spalten und 216 Reihen sind, gehe nochmals zur vorherigen Übung und überprüfe deinen Code**

2. Starte mit dem neu erstellten Objekt im langen Format, und erstelle eine Code Sequenz, in welcher:

- die Funktionen `group_by()` und `summarise()` um die Summe der Emmissionen pro Jahr zu berechnen
- die Funktionen `mutate()` und `lag()` die Differenz zwischen den Jahren berechnen

3. Speicher das Ergebnis als ein neues Objekt in deiner Arbeitsumgebung (Environment) mit einem Namen deiner Wahl

```{r}

ghg_long_sum <- ghg_long %>% 
  group_by(Jahr) %>% 
  summarise(
    Summe = sum(Emissionen)
  ) %>% 
  mutate(Differenz = Summe - lag(Summe))

```

## 2.3 Daten visualisieren 1

1. Starte mit dem Objekt, welches du in Schritt 3 der vorheringen Übung erstellt hast
2. Erstelle ein Säulendiagram und lege das Jahr auf die x-Achse und die Differenz der Emissionen zwischen den Jahren auf die y-Achse
3. **Bonus:** Warum ist auf der x-Achse immer nur für alle zehn Jahre ein Tick mit Beschriftung?  
4. **Bonus:** Wandle den Typen der Variable "Jahr" in einen Faktor um bevor du den Plot erstellst
5. **Bonus:** Passe das Layout des Plots beliebig an

```{r}

ghg_long_sum %>% 
  mutate(Jahr = as_factor(Jahr)) %>% 
  ggplot(aes(x = Jahr, y = Differenz)) +
  geom_col()
```


## 2.4 Daten visualisieren 2 (Bonus)

1. Nutze das Objekt welches du in "2.1 Pivoting" erstellt hast, und:

- Nutze die Funktion `group_by()` um die Daten nach dem Jahr zu gruppieren
- Nutze die Funktion `filter()` um in der Spalte Jahr nur das Jahr 1990 und das Jahr 2016 anzuzeigen
- Wieviele Wege fallen dir ein um auf das Ergebnis zu kommen?

2. Speicher das Ergebnis als ein neues Objekt in deiner Arbeitsumgebung (Environment) mit einem Namen deiner Wahl

3. Reproduziere folgendes verbundenes Säulendiagramm

```{r}

ghg_long_filter <- ghg_long %>% 
  filter(Jahr == max(Jahr) | Jahr == min(Jahr))

# Zwei weitere Wege
# ghg_long %>% 
#   filter(Jahr %in% c(2016, 1990))  
# 
# ghg_long %>% 
#   filter(Jahr == 2016 | Jahr == 1990)

```

```{r}
ggplot(data = ghg_long_filter,                            
       mapping = aes(x = Jahr,                    
                     y = Emissionen,                  
                     color = Energietraeger))  +   
  
  geom_line(size = 1) + 
  geom_point(size = 3) + 
  
  # Plot Styling ab hier  
  labs(title = "Treibhausgasemissionen in der Stadt Zürich, 1990 und 2016",
       subtitle = "inklusive internationalem Flugverkehr, ohne Klimakorrektur",
       y = "Treibhausgasemissionen [t CO2eq/Person]",
       x = NULL,
       caption = "Daten: https://data.stadt-zuerich.ch/dataset/ugz_treibhausgasbilanz",
       fill = "Energieträger") +
  scale_x_continuous(limits = c(1990, 2016), 
                     breaks = c(1990, 2016)) +
  scale_color_brewer(type = "qual") +
  theme_minimal() +
  theme(panel.grid.minor = element_blank())

```



```{r treibhausgas-tab2, fig.show="hide", echo=TRUE}

ghg_tidy <- ghg %>% 
  pivot_longer(
    cols = Strom:Heizoel_EL,     # Variablen von Strom bis Heizoel_EL
    names_to = "Energietraeger", # Variablen Namen -> Neue Spalte Energietraeger
    values_to = "Emissionen"     # Variablen Werte -> Neue Spalte Emissionen
  ) %>% 
  group_by(Jahr) %>%   #<< 
  mutate(Prozent = Emissionen / sum(Emissionen) * 100) %>%  #<<
  ungroup() %>% #<<
  filter(Jahr == max(Jahr) | Jahr == min(Jahr)) #<< 

```

```{r ref.label="treibhausgas1-tab2"}
ghg_tidy %>% 
  arrange(Energietraeger)
```

```{r treibhausgas3, fig.show="hide", echo=TRUE}

ggplot(data = ghg_tidy,                            # Daten im neuen Format
       mapping = aes(x = Jahr,                     # Nur 1990 und 2016
                     y = Prozent,                  # Neue Variable Prozent
                     color = Energietraeger))  +   # Energieträger als Farben
  
  geom_line(size = 1) + #<<
  geom_point(size = 5) + #<<
  
  # Plot Styling ab hier  
  labs(title = "Treibhausgasbilanz 1990 und 2016",
       y = "Treibhausgasemissionen [Prozent]",
       x = NULL,
       caption = "Daten: https://data.stadt-zuerich.ch/dataset/ugz_treibhausgasbilanz",
       fill = "Energieträger") +
  scale_x_continuous(limits = c(1990, 2016), 
                     breaks = c(1990, 2016)) +
  scale_color_brewer(type = "qual") +
  theme_minimal() +
  theme(panel.grid.minor = element_blank())
```



1. Starte mit dem neu erstellen Objekt, welches sich nun in einem langen Format sein sollte. 
2. Nutze die Funktion `group_by()` um die Daten nach der Variable "Jahr" zu gruppieren.
3. Nutze die Funktion `mutate()` um eine neue Variable mit dem Namen "Prozent" zu erstellen. Die Variable soll den prozentualen Anteil der Emissionen der einzelnen Energieträger für jedes Jahr darstellen. **Tipp: Prozent = x / sum(x) * 100**

```{r}




```


